<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Rappel MÃ©dicaments</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="styles.css">
  <link rel="apple-touch-icon" href="apple-touch-icon-v2.png?v=2">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Rappel MÃ©dicaments">
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <h1>As-tu pris tes mÃ©dicaments aujourdâ€™hui ?</h1>

    <!-- SÃ©lecteur de nombre de prises -->
    <div id="setup" class="setup">
      <p>Combien de prises par jour ?</p>
      <button onclick="setPrises(1)">1</button>
      <button onclick="setPrises(2)">2</button>
      <button onclick="setPrises(3)">3</button>
    </div>

    <!-- Zone de confirmation dynamique -->
    <div id="prise-buttons"></div>

    <!-- Message gÃ©nÃ©ral (non utilisÃ© ici mais gardÃ©) -->
    <p id="confirmation-message"></p>

    <!-- Phrase douce -->
    <p class="quote">ðŸŒ¸ Prends soin de toi ðŸ’•</p>

    <!-- Bouton de rÃ©initialisation -->
    <button id="reset-btn" class="reset">ðŸ”„ RÃ©initialiser la journÃ©e</button>


    <!-- Changement de fond personnalisÃ© -->
    <input type="file" id="backgroundPicker" accept="image/*">
  </div>

 <script>
  document.addEventListener('DOMContentLoaded', () => {
    const backgroundPicker = document.getElementById('backgroundPicker');
    const savedBackground = localStorage.getItem('userBackground');
    if (savedBackground) {
      document.body.style.backgroundImage = `url(${savedBackground})`;
    }

    backgroundPicker.addEventListener('change', function (event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        const dataURL = e.target.result;
        document.body.style.backgroundImage = `url(${dataURL})`;
        document.body.style.backgroundSize = 'cover';
        document.body.style.backgroundPosition = 'center';
        localStorage.setItem('userBackground', dataURL);
      };
      reader.readAsDataURL(file);
    });

    const savedPrises = localStorage.getItem('nbPrises');
    if (savedPrises) {
      document.getElementById('setup').style.display = 'none';
      generatePriseButtons(parseInt(savedPrises));
    }

    // âœ… Bouton de rÃ©initialisation
    document.getElementById('reset-btn').addEventListener('click', () => {
      const today = new Date().toISOString().split('T')[0];
      const nbPrises = localStorage.getItem('nbPrises');

      if (nbPrises) {
        for (let i = 1; i <= parseInt(nbPrises); i++) {
          const key = `taken-${today}-prise-${i}`;
          const nameKey = `name-${today}-prise-${i}`;
          localStorage.removeItem(key);
          localStorage.removeItem(nameKey);
        }
      }

      localStorage.removeItem('nbPrises');
      document.getElementById('prise-buttons').innerHTML = '';
      document.getElementById('name-inputs').style.display = 'none';
      document.getElementById('setup').style.display = 'block';
    });
  });

  function setPrises(n) {
    localStorage.setItem('nbPrises', n);
    const nameInputs = document.getElementById('name-inputs');
    nameInputs.innerHTML = '';
    nameInputs.style.display = 'block';

    for (let i = 1; i <= n; i++) {
      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = `Nom de la prise nÂ°${i}`;
      input.id = `name-input-${i}`;
      input.required = true;
      nameInputs.appendChild(input);
    }

    const confirmBtn = document.createElement('button');
    confirmBtn.textContent = "Valider les noms";
    confirmBtn.onclick = () => {
      const today = new Date().toISOString().split('T')[0];
      for (let i = 1; i <= n; i++) {
        const input = document.getElementById(`name-input-${i}`);
        localStorage.setItem(`name-${today}-prise-${i}`, input.value || `Prise nÂ°${i}`);
      }
      nameInputs.style.display = 'none';
      document.getElementById('setup').style.display = 'none';
      generatePriseButtons(n);
    };
    nameInputs.appendChild(confirmBtn);
  }

  function generatePriseButtons(n) {
    const container = document.getElementById('prise-buttons');
    const today = new Date().toISOString().split('T')[0];
    container.innerHTML = '';

    for (let i = 1; i <= n; i++) {
      const key = `taken-${today}-prise-${i}`;
      const btn = document.createElement('button');
      const name = localStorage.getItem(`name-${today}-prise-${i}`) || `Prise nÂ°${i}`;
      btn.textContent = name;
      btn.id = `btn-${i}`;
      if (localStorage.getItem(key)) {
        btn.classList.add('clicked');
        btn.textContent = `âœ… ${name} â€” ${localStorage.getItem(key)}`;
      }
      btn.addEventListener('click', () => {
        const now = new Date();
        const time = now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
        localStorage.setItem(key, time);
        btn.classList.add('clicked');
        btn.textContent = `âœ… ${name} â€” ${time}`;
      });
      container.appendChild(btn);
    }
  }
</script>

</body>
</html>
